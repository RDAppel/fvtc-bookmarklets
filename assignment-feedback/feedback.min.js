javascript:(()=>{let e=localStorage.getItem("right-to-left")||"false";localStorage.setItem("right-to-left",e);let t="feedback-panel",n=document.querySelector(`#${t}`);if(n){let{display:r}=window.getComputedStyle(n,null);n.style.display="none"===r?"block":"none";return}let a=document.querySelector("#crumb_1")?.innerText.trim().split(" ").slice(0,-1).join(" "),l=document.querySelector("#pageTitleText")?.innerText;if(!a||!l)return;let i=`
		#feedback-panel{background-color:white;position:fixed;left:0;right:412px;bottom:0;min-height:30%;border:1px solid darkgray;padding:12px 48px;z-index:1000;}
		#feedback-panel a{underline;cursor:pointer;}
		#feedback-panel a:hover{text-decoration:underline;}
		#feedback-panel-container{display:flex;flex-direction:row;justify-content:space-between;align-content:stretch;gap:4px;width:100%;height:100%;border:0;}
		.feedback-panel-inner {background-color:#eee;padding:12px;margin-bottom:12px;flex-grow:1;min-width:25%;height:100%}
		.feedback-panel-inner .items {min-height:75%;overflow-y:scroll;}
		.feedback-panel-inner p {margin:2px;}
		.feedback-panel-inner p a {margin-right:1em;}
		.feedback-panel-inner .title {font-weight:bold;border-bottom:1px solid black;padding-bottom:2px;margin-bottom:4;text-align:center;}
		.feedback-panel-inner button {margin-top:2px;margin-right:2px;}
		.drop {min-height:20px;background-color:#fff;border:1px solid #777;padding:2px;}
	`,d=document.createElement("style");d.styleSheet?d.styleSheet.cssText=i:d.appendChild(document.createTextNode(i)),document.querySelector("head").appendChild(d);let o={General:"generalFeedback",Course:`courseFeedback-${a}`,Assignment:`assignmentFeedback-${l}-${a}`},c=e=>JSON.parse(localStorage.getItem(o[e]))||[],p=(e,t)=>{localStorage.setItem(o[e],JSON.stringify(t))},s=document.querySelector("#feedbacktext_ifr");if(!s)return alert("no iframe found");let m=s.contentWindow.document.querySelector("#tinymce"),u=document.querySelector("#currentAttempt_gradeDataPanelLink");"true"!==u.getAttribute("aria-expanded")&&u.click();let f=document.querySelector("#panelbutton2 > div > div.user-navigator > div.students-pager > h3 > span:nth-child(3)")?.innerText.split(" (Attempt")[0],b=f.split(" ")[0],g=e=>{let t=document.createRange();t.selectNodeContents(e),t.collapse(!1);let n=window.getSelection();n.removeAllRanges(),n.addRange(t)},x=document.querySelector("body"),h=document.createElement("div");h.id=t,h.classList.add("feedback-panel"),x.append(h);let k=document.createElement("div");k.id="feedback-panel-container",h.append(k);let y=(e,t)=>{e=e.trim().replace("{{firstName}}",b);let n="{{check}}",{length:r}=n,a=document.createElement("p");t.append(a);let l=document.createElement("a");a.append(l),l.innerText=e.replace(n,"");let i=(e=!1)=>{g(m),m.focus();let t=document.createElement("p");t.innerText=l.innerText,m.append(t);let n=m.querySelector("p"),r=n.innerText;""===r.trim()&&n.remove(),e&&(document.querySelector("#currentAttempt_grade").value=document.querySelector("#currentAttempt_pointsPossible").innerText.slice(1),document.querySelector("#currentAttempt_submitButton").dispatchEvent(new Event("click")))};if(l.addEventListener("click",()=>i(!1)),e.substring(e.length-r)===n){let d=document.createElement("a");d.title="Add feedback and submit with full points.",a.append(d),d.innerText="âˆš",d.addEventListener("click",()=>i(!0))}},E=(e,t,n="text/plain")=>{let r=document.createElement("a"),a=new Blob([e],{type:n});r.href=URL.createObjectURL(a),r.download=t,r.click()},v=Object.keys(o);("true"===e?v.reverse():v).forEach(e=>{let t=document.createElement("div");t.classList.add("feedback-panel-inner"),k.append(t);let n=document.createElement("div");n.innerText=`${e} Feedback`,t.append(n),n.classList.add("title");let r=document.createElement("div");t.append(r),r.classList.add("items"),c(e).forEach(e=>y(e,r));let a=document.createElement("button");a.innerText=`New ${e} Feedback`,a.addEventListener("click",()=>{let t=window.prompt("Enter feedback text (use {{firstName}} to insert student's first name). Optionally you can add {{check}} to the end and this will add the ability to auto submit with full credit.");t&&(y(t,r),p(e,[...c(e),t]))}),t.append(a);let l=document.createElement("div");l.classList.add("feedback-import-export"),t.append(l);let i=document.createElement("button");i.textContent="Export",l.append(i),i.addEventListener("click",()=>{let t=JSON.stringify(c(e));E(t,`${e}.json`)});let d=document.createElement("button");d.textContent="Delete All",l.append(d),d.addEventListener("click",()=>{confirm(`Are you sure you want to delete all ${e} Feedback items?`)&&(p(e,[]),r.innerHTML="")});let o=document.createElement("div"),s="Import - Drop file here.";o.textContent=s,o.classList.add("drop"),l.append(o),o.addEventListener("dragover",e=>e.preventDefault()),o.addEventListener("drop",t=>{t.preventDefault();let{dataTransfer:n}=t;if(!n)return;let{files:a}=n;a&&([...a].forEach(t=>{let n=new FileReader;n.onload=t=>{try{let n=JSON.parse(t.target.result);n.forEach(e=>y(e,r)),p(e,[...c(e),...n]),o.textContent="Imported!"}catch{o.textContent="Error!"}},n.onerror=()=>o.textContent="Error!",n.readAsText(t,"UTF-8")}),setTimeout(()=>o.textContent=s,3e3))})})})();